name: Compile ZSign for Linux

on: push

env:
  BUILD_TYPE: Release
  VERBOSE: 1

jobs:
  build-zsign:
    runs-on: ubuntu-22.04

    steps:
      - uses: actions/checkout@v3
        with:
          submodules: recursive

      - name: Install dependencies 
        run: |
          sudo add-apt-repository ppa:xmake-io/xmake
          sudo apt-get update && sudo apt-get install -y git zip unzip curl xmake
          
      - name: Clone the linux-optimised repo
        run: |
          git clone https://github.com/zhlynn/zsign.git
      - name: Compile zsign
        run: |
          pwd
          cd zsign
          xmake
          xmake install -o build
          
      - uses: actions/upload-artifact@v3
        with:
          name: zsign
          path: |
            ${{github.workspace}}/build/bin/zsign
